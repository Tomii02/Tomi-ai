<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tomii - Dashboard Layanan</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --bg-color: #0b1122;
      --card-bg: rgba(255, 255, 255, 0.08);
      --border-color: rgba(255, 255, 255, 0.2);
      --text-color: #e2e8f0;
      --accent-blue: #0ea5e9;
      --shadow-light: rgba(0, 0, 0, 0.3);
      --shadow-dark: rgba(0, 0, 0, 0.6);
    }
    
    body {
      margin: 0;
      font-family: 'Lexend', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: var(--text-color);
      background-color: var(--bg-color);
      position: relative;
      overflow: hidden;
      background: linear-gradient(145deg, #0f172a, #0b1122);
    }

    #bg-media-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      opacity: 0.15;
      filter: blur(10px);
    }
    
    #bg-media-container video, 
    #bg-media-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .main-box {
      width: 380px;
      padding: 40px;
      border-radius: 25px;
      text-align: center;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      box-shadow: 0 10px 40px var(--shadow-dark);
      backdrop-filter: blur(25px) saturate(180%);
      -webkit-backdrop-filter: blur(25px) saturate(180%);
      animation: fadeIn 1s ease-in-out;
      z-index: 1;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9) translateY(20px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .profile-img {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      border: 3px solid var(--accent-blue);
      margin-bottom: 25px;
      object-fit: cover;
      box-shadow: 0 0 20px var(--accent-blue);
      transition: transform 0.4s ease, box-shadow 0.4s ease;
    }
    
    .profile-img:hover {
      transform: scale(1.05) rotate(5deg);
      box-shadow: 0 0 30px var(--accent-blue);
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-top: 0;
      margin-bottom: 5px;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    h2 {
      font-size: 16px;
      font-weight: 400;
      margin-bottom: 30px;
      color: #94a3b8;
    }
    
    input {
      width: calc(100% - 24px);
      padding: 14px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-color);
      text-align: center;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    
    input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    input:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 12px var(--accent-blue);
    }

    .button-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    .button-full {
      grid-column: span 2;
    }

    button {
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      text-transform: uppercase;
      box-shadow: 0 4px 15px var(--shadow-light);
    }
    
    button:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px var(--shadow-light);
    }
    
    .wa { background: #25D366; color: #fff; }
    .wa:hover { background: #1eaa59; }

    .ai { background: #0ea5e9; color: #fff; }
    .ai:hover { background: #0284c7; }

    .trap { background: #a855f7; color: #fff; }
    .trap:hover { background: #9333ea; }
    
    .shop-btn { background: #34d399; color: #111827; }
    .shop-btn:hover { background: #10b981; }
    
    .jurnal-btn { background: #f43f5e; color: #fff; }
    .jurnal-btn:hover { background: #e11d48; }
    
    .keuangan-btn { background: #f59e0b; color: #fff; }
    .keuangan-btn:hover { background: #d97706; }

    .history-btn { background: #94a3b8; color: #111827; }
    .history-btn:hover { background: #64748b; }
    
    .generator-btn { background: #c084fc; color: #111827; }
    .generator-btn:hover { background: #a855f7; }

    .whatsapp-pairing { background: #0c4a6e; color: #fff; }
    .whatsapp-pairing:hover { background: #083344; }

    .watermark {
      position: absolute;
      bottom: 20px;
      left: 20px;
      color: rgba(255, 255, 255, 0.3);
      font-size: 14px;
      font-weight: 300;
      z-index: 1;
    }

    .admin-login-box {
      background: var(--card-bg);
      padding: 25px;
      border-radius: 15px;
      margin-top: 25px;
      display: none;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    .admin-login-box input {
      width: calc(100% - 24px);
    }
    
    .admin-login-box button {
      background: var(--accent-blue);
      color: var(--text-color);
    }
    
    .admin-menu {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 25px;
    }
  </style>
</head>
<body>
  
  <div id="bg-media-container">
    <video src="https://c.termai.cc/v27/vKp.mp4" autoplay loop muted playsinline></video>
  </div>

  <div class="main-box">
    <img src="https://c.termai.cc/i39/mLLz.jpg" alt="Tomii" class="profile-img" id="tomi-logo">
    <h1>Selamat Datang</h1>
    <h2>Dashboard Website Tomii</h2>
    <input id="nama" type="text" placeholder="Masukkan nama kamu">
    <div class="button-container">
      <button class="ai" onclick="gotoAI()">
        <i class="fas fa-robot"></i> Tanya AI
      </button>
      <button class="trap" onclick="gotoTrap()">
        <i class="fas fa-heart"></i> Buat Kamu
      </button>
      <button class="shop-btn" onclick="gotoTomiShop()">
        <i class="fas fa-shopping-cart"></i> TomiShop
      </button>
      <button class="jurnal-btn" onclick="gotoJurnal()">
        <i class="fas fa-chart-line"></i> Jurnal Bisnis
      </button>
      <button class="keuangan-btn" onclick="gotoKeuangan()">
        <i class="fas fa-file-invoice-dollar"></i> Laporan Keuangan
      </button>
      <button class="history-btn" onclick="gotoHistoryChat()">
        <i class="fas fa-history"></i> History Chat WA
      </button>
      <button class="generator-btn" onclick="gotoGenerator()">
        <i class="fas fa-file-code"></i> Buat Web
      </button>
      <button class="wa button-full" onclick="balikWA()">
        <i class="fab fa-whatsapp"></i> Tomii-Dev
      </button>
    </div>
    
    <div id="admin-login-form" class="admin-login-box">
        <input type="email" id="adminEmail" placeholder="Email Admin">
        <input type="password" id="adminPassword" placeholder="Kata Sandi Admin">
        <button onclick="loginAdmin()">
            <i class="fas fa-sign-in-alt"></i> Login
        </button>
    </div>
    
    <div id="admin-menu" class="admin-menu" style="display: none;">
      <button class="admin-btn" onclick="createVoucher()">
        <i class="fas fa-ticket-alt"></i> Buat Voucher
      </button>
      <button class="admin-btn" onclick="refillVoucher()">
        <i class="fas fa-redo-alt"></i> Isi Ulang Voucher
      </button>
    </div>
  </div>
  
  <div class="watermark">
    Developer: @Tomii
  </div>

  <script>
    function balikWA() {
      const nama = document.getElementById("nama").value.trim() || "Pengguna";
      const text = `Halo, nama saya ${nama}. Salam kenal.`;
      window.location.href = "https://wa.me/6285281555650?text=" + encodeURIComponent(text);
    }
    
    function gotoTrap() {
      const nama = document.getElementById("nama").value.trim() || "Sayang";
      localStorage.setItem('playMusic', 'true');
      window.location.href = `bucinweb.html?nama=${encodeURIComponent(nama)}`;
    }
    
    function gotoAI() {
      const nama = document.getElementById("nama").value.trim() || "Pengguna";
      window.location.href = "chat.html?nama=" + encodeURIComponent(nama);
    }
    
    function gotoJurnal() {
      const nama = document.getElementById("nama").value.trim() || "Pengguna";
      window.location.href = "jurnal.html?nama=" + encodeURIComponent(nama);
    }
    
    function gotoKeuangan() {
      const nama = document.getElementById("nama").value.trim() || "Pengguna";
      window.location.href = "jurnal2.html?nama=" + encodeURIComponent(nama);
    }
    
    function gotoHistoryChat() {
      window.location.href = "chat_viewer.html";
    }
    
    function gotoGenerator() {
      window.location.href = "generator.html";
    }
    
    function gotoTomiShop() {
      window.location.href = "TomiShop.html";
    }

    const API_URL = 'http://localhost:3000/api';
    
    const bellaLogo = document.getElementById('tomi-logo');
    let clickCount = 0;
    let clickTimeout;

    bellaLogo.addEventListener('click', () => {
        clickCount++;
        clearTimeout(clickTimeout);
        clickTimeout = setTimeout(() => {
            clickCount = 0;
        }, 1000);

        if (clickCount === 5) {
            document.getElementById('admin-login-form').style.display = 'block';
            alert("Silakan masukkan email dan kata sandi admin.");
            clickCount = 0;
        }
    });

    const adminEmailInput = document.getElementById('adminEmail');
    const adminPasswordInput = document.getElementById('adminPassword');

    function allowTextDeletion(event) {
        if (event.key === 'Backspace' || event.key === 'Delete') {
            return true;
        }
    }

    if (adminEmailInput) {
        adminEmailInput.addEventListener('keydown', allowTextDeletion);
    }
    if (adminPasswordInput) {
        adminPasswordInput.addEventListener('keydown', allowTextDeletion);
    }

    async function loginAdmin() {
        const email = document.getElementById('adminEmail').value;
        const password = document.getElementById('adminPassword').value;

        if (!email || !password) {
            alert('Email dan kata sandi harus diisi.');
            return;
        }

        try {
            const response = await fetch(`${API_URL}/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();
            if (data.status) {
                localStorage.setItem('token', data.token);
                alert('Login Admin Berhasil!');
                checkAdminStatus();
                document.getElementById('admin-login-form').style.display = 'none';
            } else {
                alert('Login Gagal: ' + data.message);
            }
        } catch (error) {
            console.error('Login error:', error);
            alert('Terjadi kesalahan saat login.');
        }
    }

    async function checkAdminStatus() {
        const token = localStorage.getItem('token');
        if (!token) {
            console.log('Tidak ada token, menu admin tidak ditampilkan.');
            return;
        }

        try {
            const response = await fetch(`${API_URL}/auth/admin-status`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}` 
                }
            });
            
            const data = await response.json();

            if (data.isAdmin) {
                const adminMenu = document.getElementById('admin-menu');
                if (adminMenu) {
                    adminMenu.style.display = 'grid';
                    console.log('Pengguna adalah admin, menu rahasia ditampilkan.');
                }
            } else {
                console.log('Pengguna bukan admin atau token tidak valid.');
                localStorage.removeItem('token');
            }
        } catch (error) {
            console.error('Gagal memvalidasi token:', error);
            localStorage.removeItem('token');
        }
    }

    document.addEventListener('DOMContentLoaded', checkAdminStatus);
    
    // Add WhatsApp pairing button
    document.addEventListener('DOMContentLoaded', function() {
        const buttonContainer = document.querySelector('.button-container');
        if (buttonContainer) {
            const whatsappPairingButton = document.createElement('button');
            whatsappPairingButton.className = 'whatsapp-pairing button-full';
            whatsappPairingButton.onclick = function() {
                window.location.href = 'whatsapp.html';
            };
            whatsappPairingButton.innerHTML = '<i class="fab fa-whatsapp"></i> Pairing WhatsApp Bot';
            buttonContainer.appendChild(whatsappPairingButton);
        }
    });

    function createVoucher() {
      const code = prompt("Masukkan kode voucher:");
      const type = prompt("Masukkan tipe (domain/service):");
      const value = prompt("Masukkan nilai diskon (angka):");
      
      if (code && type && value) {
        alert(`Membuat voucher:\nKode: ${code}\nTipe: ${type}\nNilai: Rp${value}`);
      }
    }

    function refillVoucher() {
      const code = prompt("Masukkan kode voucher yang akan diisi ulang:");
      if (code) {
        alert(`Mengisi ulang voucher:\nKode: ${code}`);
      }
    }
  </script>
</body>
</html>
